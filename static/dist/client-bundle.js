let m=null;function w(e){m=e,m.on("load_abilities",t=>{C(t)})}document.addEventListener("DOMContentLoaded",()=>{name=sessionStorage.getItem("charName"),char_id=sessionStorage.getItem("charId")});function C(e){const t=e.abilities,n=t.str_num,i=t.dex_num,o=t.con_num,a=t.int_num,d=t.wis_num,r=t.cha_num,[q,I,b,L,B,M]=h();q.value=n,I.value=i,b.value=o,L.value=a,B.value=d,M.value=r,H()}function h(){const e=document.querySelector("#strength-input"),t=document.querySelector("#dexterity-input"),n=document.querySelector("#constitution-input"),i=document.querySelector("#intelligence-input"),o=document.querySelector("#wisdom-input"),a=document.querySelector("#charisma-input");return[e,t,n,i,o,a]}function k(){const[e,t,n,i,o,a]=h();e.addEventListener("change",function(){g(),u()}),t.addEventListener("change",function(){p(),u()}),n.addEventListener("change",function(){y(),u()}),i.addEventListener("change",function(){v(),u()}),o.addEventListener("change",function(){f(),u()}),a.addEventListener("change",function(){S(),u()})}function H(){g(),p(),y(),v(),f(),S()}function g(){const e=document.querySelector("#strength-input"),t=document.querySelector("#strength-modifier"),n=s(e);l(t,n)}function p(){const e=document.querySelector("#dexterity-input"),t=document.querySelector("#dexterity-modifier"),n=s(e);l(t,n)}function y(){const e=document.querySelector("#constitution-input"),t=document.querySelector("#constitution-modifier"),n=s(e);l(t,n)}function v(){const e=document.querySelector("#intelligence-input"),t=document.querySelector("#intelligence-modifier"),n=s(e);l(t,n)}function f(){const e=document.querySelector("#wisdom-input"),t=document.querySelector("#wisdom-modifier"),n=s(e);l(t,n)}function S(){const e=document.querySelector("#charisma-input"),t=document.querySelector("#charisma-modifier"),n=s(e);l(t,n)}function l(e,t){e.textContent="("+t.toString()+")"}function s(e){const t=e.value;return Math.floor((parseInt(t)-10)/2)}function u(){const[e,t,n,i,o,a]=h(),d={str_num:e.value,dex_num:t.value,con_num:n.value,int_num:i.value,wis_num:o.value,cha_num:a.value},r={char_id,abilities:d};m.emit("save_abilities",r)}function D(e){w(e)}const c=io();D(c);document.addEventListener("DOMContentLoaded",()=>{name=sessionStorage.getItem("charName"),char_id=sessionStorage.getItem("charId");const e=document.querySelector(".max-health");e.addEventListener("change",function(){N(e.value)}),T(),k()});function T(){c.emit("register_name",{name,char_id})}function $(){const e=document.getElementById("msg").value;e&&(c.emit("message_to_dm",{message:e,char_id,char_name:name}),E("You",e),document.getElementById("msg").value="")}function F(e){const t=document.getElementById("chat"),n=document.createElement("p"),i=e.indexOf(":");let o=e.slice(0,i);o!=="DM"&&(o="You");const a=e.slice(i+1);n.innerHTML=`<strong>${o}:</strong> ${a}`,t.appendChild(n),t.scrollTop=t.scrollHeight}function E(e,t){const n=document.getElementById("chat"),i=document.createElement("p");i.innerHTML=`<strong>${e}:</strong> ${t}`,n.appendChild(i),n.scrollTop=n.scrollHeight}function _(){const e=parseFloat(document.getElementById("heal-input").value)||0,t=parseFloat(document.getElementById("damage-input").value||0),n=document.getElementById("health-num");let o=(parseFloat(n.textContent)||0)-t+e;const a=document.querySelector(".max-health").value;o>a&&(o=a),n.textContent=o.toString(),document.getElementById("heal-input").value="",document.getElementById("damage-input").value="",c.emit("client_update_health",{result:o,char_id})}function O(e){const t=document.querySelector(".initiative-input-container");t.style.display="flex",t.querySelector("#combat-id").textContent=e}function x(){const e=document.querySelector(".initiative-input-container");e.style.display="none",e.querySelector("#init-number").value=0,e.querySelector("#combat-id").textContent=""}function A(){const e=document.querySelector(".initiative-input-container"),t=e.querySelector("#combat-id").textContent,n=e.querySelector("#init-number").value;c.emit("player_input_init",{char_id,combat_id:t,init:n,char_name:name}),x()}function N(){const e=document.querySelector(".max-health");c.emit("client_update_max_health",{max_health:e.value,char_id})}function Y(e){const t=document.querySelector(".max-health");t.value=e}c.on("host_update_max_health",e=>{const t=e.max_health;Y(t)});c.on("load_message",e=>{F(e.message)});c.on("private_message",e=>{E(e.from,e.message),document.getElementById("chat-area").classList.contains("mobile-hidden")&&(document.getElementById("toggle-chat").style.backgroundColor="red")});c.on("send_image",e=>{let t=e.n;t==null&&(t=!0);const n=document.createElement("div");n.classList.add("image-box");const i=document.createElement("img");i.src=e.url,i.alt="Shared by DM",n.appendChild(i),document.getElementById("images").appendChild(n);const o=document.getElementById("image-area");t&&o.classList.contains("mobile-hidden")&&(document.getElementById("toggle-imgs").style.backgroundColor="red")});c.on("host_update_health",({result:e,client_id:t})=>{const n=document.getElementById("health-num");n.textContent=e.toString()});c.on("host_change_armor_class",({value:e})=>{const t=document.getElementById("ac-input");t.value=e});c.on("initialize_combat",({combat_id:e})=>{O(e)});document.addEventListener("DOMContentLoaded",function(){console.log("ran"),document.querySelector("#submit-init-button").addEventListener("click",function(){A()}),document.querySelector("#hide-init-overlay-button").addEventListener("click",function(){x()}),document.getElementById("heal-input").addEventListener("change",function(e){_()}),document.getElementById("damage-input").addEventListener("change",function(e){_()}),document.getElementById("msg").addEventListener("change",function(e){$()}),document.getElementById("ac-input").addEventListener("change",function(e){const t=document.getElementById("ac-input").value;c.emit("client_change_armor_class",{value:t,char_id})})});
