let r=null;function w(e){r=e,r.on("load_abilities",t=>{b(t)})}document.addEventListener("DOMContentLoaded",()=>{name=sessionStorage.getItem("charName"),char_id=sessionStorage.getItem("charId")});function b(e){const t=e.abilities;console.log(t);const n=t.str_num,o=t.dex_num,c=t.con_num,a=t.int_num,m=t.wis_num,d=t.cha_num;console.log(d),console.log(parseInt(d));const[S,I,q,L,B,M]=h();S.value=n,I.value=o,q.value=c,L.value=a,B.value=m,M.value=d,H()}function h(){const e=document.querySelector("#strength-input"),t=document.querySelector("#dexterity-input"),n=document.querySelector("#constitution-input"),o=document.querySelector("#intelligence-input"),c=document.querySelector("#wisdom-input"),a=document.querySelector("#charisma-input");return[e,t,n,o,c,a]}function C(){const[e,t,n,o,c,a]=h();e.addEventListener("change",function(){g(),u()}),t.addEventListener("change",function(){p(),u()}),n.addEventListener("change",function(){v(),u()}),o.addEventListener("change",function(){y(),u()}),c.addEventListener("change",function(){f(),u()}),a.addEventListener("change",function(){E(),u()})}function H(){g(),p(),v(),y(),f(),E()}function g(){const e=document.querySelector("#strength-input"),t=document.querySelector("#strength-modifier"),n=s(e);l(t,n)}function p(){const e=document.querySelector("#dexterity-input"),t=document.querySelector("#dexterity-modifier"),n=s(e);l(t,n)}function v(){const e=document.querySelector("#constitution-input"),t=document.querySelector("#constitution-modifier"),n=s(e);l(t,n)}function y(){const e=document.querySelector("#intelligence-input"),t=document.querySelector("#intelligence-modifier"),n=s(e);l(t,n)}function f(){const e=document.querySelector("#wisdom-input"),t=document.querySelector("#wisdom-modifier"),n=s(e);l(t,n)}function E(){const e=document.querySelector("#charisma-input"),t=document.querySelector("#charisma-modifier"),n=s(e);l(t,n)}function l(e,t){e.textContent="("+t.toString()+")"}function s(e){const t=e.value;return Math.floor((parseInt(t)-10)/2)}function u(){const[e,t,n,o,c,a]=h(),m={str_num:e.value,dex_num:t.value,con_num:n.value,int_num:o.value,wis_num:c.value,cha_num:a.value},d={char_id,abilities:m};r.emit("save_abilities",d)}function k(e){w(e)}const i=io();k(i);document.addEventListener("DOMContentLoaded",()=>{name=sessionStorage.getItem("charName"),char_id=sessionStorage.getItem("charId");const e=document.querySelector(".max-health");e.addEventListener("change",function(){O(e.value)}),D(),C()});function D(){i.emit("register_name",{name,char_id})}function T(){const e=document.getElementById("msg").value;e&&(i.emit("message_to_dm",{message:e,char_id,char_name:name}),x("You",e),document.getElementById("msg").value="")}function $(e){const t=document.getElementById("chat"),n=document.createElement("p"),o=e.indexOf(":");let c=e.slice(0,o);c!=="DM"&&(c="You");const a=e.slice(o+1);n.innerHTML=`<strong>${c}:</strong> ${a}`,t.appendChild(n),t.scrollTop=t.scrollHeight}function x(e,t){const n=document.getElementById("chat"),o=document.createElement("p");o.innerHTML=`<strong>${e}:</strong> ${t}`,n.appendChild(o),n.scrollTop=n.scrollHeight}function _(){const e=parseFloat(document.getElementById("heal-input").value)||0,t=parseFloat(document.getElementById("damage-input").value||0),n=document.getElementById("health-num");let c=(parseFloat(n.textContent)||0)-t+e;const a=document.querySelector(".max-health").value;c>a&&(c=a),n.textContent=c.toString(),document.getElementById("heal-input").value="",document.getElementById("damage-input").value="",i.emit("client_update_health",{result:c,char_id})}function F(e){const t=document.querySelector(".initiative-input-container");t.style.display="flex",t.querySelector("#combat-id").textContent=e}function O(){const e=document.querySelector(".max-health");i.emit("client_update_max_health",{max_health:e.value,char_id})}function A(e){const t=document.querySelector(".max-health");t.value=e}i.on("host_update_max_health",e=>{const t=e.max_health;A(t)});i.on("load_message",e=>{$(e.message)});i.on("private_message",e=>{x(e.from,e.message),document.getElementById("chat-area").classList.contains("mobile-hidden")&&(document.getElementById("toggle-chat").style.backgroundColor="red")});i.on("send_image",e=>{let t=e.n;t==null&&(t=!0);const n=document.createElement("div");n.classList.add("image-box");const o=document.createElement("img");o.src=e.url,o.alt="Shared by DM",n.appendChild(o),document.getElementById("images").appendChild(n);const c=document.getElementById("image-area");t&&c.classList.contains("mobile-hidden")&&(document.getElementById("toggle-imgs").style.backgroundColor="red")});i.on("host_update_health",({result:e,client_id:t})=>{const n=document.getElementById("health-num");n.textContent=e.toString()});i.on("host_change_armor_class",({value:e})=>{const t=document.getElementById("ac-input");t.value=e});i.on("initialize_combat",({combat_id:e})=>{F(e)});document.addEventListener("DOMContentLoaded",function(){document.getElementById("heal-input").addEventListener("change",function(e){_()}),document.getElementById("damage-input").addEventListener("change",function(e){_()}),document.getElementById("msg").addEventListener("change",function(e){T()}),document.getElementById("ac-input").addEventListener("change",function(e){const t=document.getElementById("ac-input").value;i.emit("client_change_armor_class",{value:t,char_id})})});
